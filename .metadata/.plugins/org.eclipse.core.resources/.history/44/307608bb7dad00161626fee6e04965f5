package webshop;


import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

public class JDBCClient {

	Connection con;
	
	JDBCClient() throws SQLException{
		this.con = DriverManager.getConnection("jdbc:postgresql://localhost:5432/webshop","test","test");
	}
	
	List<Artikel> getAllArticles() throws SQLException {
		PreparedStatement pstmt = con.prepareStatement("SELECT * FROM artikel");
		ResultSet rs = pstmt.executeQuery();
		
		ArrayList<Artikel> rl = new ArrayList<>();
		while(rs.next()){
			int anr = rs.getInt("anr");
			String abez = rs.getString("abez");
			String ainfo = rs.getString("info");
			Float preis = rs.getFloat("npreis");
			int vstueckz = rs.getInt("vstueckz");
			rl.add(new Artikel(anr,abez,ainfo,preis,vstueckz));
		}
		return rl;
	}

	void addArticle(Artikel a) throws SQLException {
		PreparedStatement ptsmt = con.prepareStatement("INSERT INTO artikel(anr,abez,npreis,vstueckz,info) values(?,?,?,?,?)");
		ptsmt.setInt(1, a.getAnr());
		ptsmt.setString(2, a.getAbez());
		ptsmt.setFloat(3, a.getPreis());
		ptsmt.setInt(4, a.getVstueckz());
		ptsmt.setString(5, a.getAinfo());
		ptsmt.executeUpdate();
	}
	
	void saveArticle(Artikel a) throws SQLException {
		PreparedStatement ptsmt = con.prepareStatement("UPDATE artikel SET anr=?,abez=?,npreis=?,vstueckz=?,info=? WHERE anr=?");
		ptsmt.setInt(1, a.getAnr());
		ptsmt.setString(2, a.getAbez());
		ptsmt.setFloat(3, a.getPreis());
		ptsmt.setInt(4, a.getVstueckz());
		ptsmt.setString(5, a.getAinfo());
		ptsmt.setInt(6, a.getAnr());
		ptsmt.executeUpdate();
	}
	
	void delArticle(Artikel a) throws SQLException{
		System.out.println("Wird aufgerufen");
		//AND abez=? AND npreis=? AND vstueckz=? AND info=?
		PreparedStatement ptsmt = con.prepareStatement("DELETE FROM artikel WHERE anr=?");
		ptsmt.setInt(1, a.getAnr());
		ptsmt.setString(2, a.getAbez());
		ptsmt.setFloat(3, a.getPreis());
		ptsmt.setInt(4, a.getVstueckz());
		ptsmt.setString(5, a.getAinfo());
		ptsmt.executeUpdate();
	}
}
